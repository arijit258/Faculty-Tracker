{% extends 'base.html' %}
{% load static %}

{% block title %}Teachers - Faculty Tracker{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header d-flex justify-content-between align-items-center">
    <div>
        <h1>Teachers</h1>
        <p>Manage faculty members and their details</p>
    </div>
    <a href="{% url 'faculty:teacher_add' %}" class="btn btn-primary">
        <i class="fas fa-plus me-2"></i>Add Teacher
    </a>
</div>

<!-- Filters Card -->
<div class="content-card animate-fadeInUp">
    <div class="content-card-body">
        <form method="GET" class="row g-3">
            <div class="col-md-4">
                <label class="form-label">Search</label>
                <input type="text" name="search" class="form-control" placeholder="Search by name, email, ID..." value="{{ request.GET.search|default:'' }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">Status</label>
                <select name="status" class="form-select">
                    <option value="">All Status</option>
                    <option value="active" {% if request.GET.status == 'active' %}selected{% endif %}>Active</option>
                    <option value="inactive" {% if request.GET.status == 'inactive' %}selected{% endif %}>Inactive</option>
                    <option value="on_leave" {% if request.GET.status == 'on_leave' %}selected{% endif %}>On Leave</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Department</label>
                <select name="department" class="form-select">
                    <option value="">All Departments</option>
                    {% for dept in departments %}
                    <option value="{{ dept.id }}" {% if request.GET.department == dept.id|stringformat:"s" %}selected{% endif %}>{{ dept.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-search me-2"></i>Filter
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Teachers Grid -->
<div class="row g-4">
    {% for teacher in teachers %}
    <div class="col-md-6 col-lg-4">
        <div class="content-card teacher-card animate-fadeInUp" style="animation-delay: {{ forloop.counter0|add:1 }}00ms;">
            <div class="content-card-body text-center">
                {% if teacher.photo %}
                <img src="{{ teacher.photo.url }}" alt="{{ teacher.full_name }}" 
                     class="rounded-circle mb-3" style="width: 80px; height: 80px; object-fit: cover;">
                {% else %}
                <div class="teacher-avatar mx-auto mb-3">
                    {{ teacher.first_name|first }}{{ teacher.last_name|first }}
                </div>
                {% endif %}
                
                <h5 class="mb-1">{{ teacher.full_name }}</h5>
                <p class="text-muted small mb-2">{{ teacher.employee_id }}</p>
                
                {% if teacher.status == 'active' %}
                <span class="badge bg-success mb-3">Active</span>
                {% elif teacher.status == 'on_leave' %}
                <span class="badge bg-warning mb-3">On Leave</span>
                {% else %}
                <span class="badge bg-secondary mb-3">Inactive</span>
                {% endif %}
                
                <div class="d-flex justify-content-center gap-3 mb-3 text-muted small">
                    <span><i class="fas fa-envelope me-1"></i>{{ teacher.email }}</span>
                </div>
                
                <div class="d-flex justify-content-center gap-2">
                    <a href="{% url 'faculty:teacher_detail' teacher.pk %}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-eye"></i>
                    </a>
                    <a href="{% url 'faculty:teacher_edit' teacher.pk %}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-edit"></i>
                    </a>
                    <button class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal{{ teacher.pk }}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="card-footer bg-transparent border-top">
                <div class="row text-center">
                    <div class="col-4 border-end">
                        <h6 class="mb-0">{{ teacher.total_sessions_conducted }}</h6>
                        <small class="text-muted">Sessions</small>
                    </div>
                    <div class="col-4 border-end">
                        <h6 class="mb-0">{{ teacher.total_hours_taught }}</h6>
                        <small class="text-muted">Hours</small>
                    </div>
                    <div class="col-4">
                        <h6 class="mb-0">{{ teacher.experience_years }}</h6>
                        <small class="text-muted">Years Exp</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Delete Modal -->
        <div class="modal fade" id="deleteModal{{ teacher.pk }}" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Delete Teacher</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete <strong>{{ teacher.full_name }}</strong>?</p>
                        <p class="text-muted small mb-0">This action cannot be undone. All associated sessions will also be deleted.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <form action="{% url 'faculty:teacher_delete' teacher.pk %}" method="POST">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="empty-state content-card">
            <i class="fas fa-users"></i>
            <h5>No Teachers Found</h5>
            <p>{% if request.GET.search %}No teachers match your search criteria.{% else %}Get started by adding your first teacher.{% endif %}</p>
            <a href="{% url 'faculty:teacher_add' %}" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>Add Teacher
            </a>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if is_paginated %}
<nav aria-label="Page navigation" class="mt-4">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page=1">&laquo; First</a>
        </li>
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
        </li>
        {% endif %}
        
        {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
        <li class="page-item active">
            <span class="page-link">{{ num }}</span>
        </li>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
        <li class="page-item">
            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
        </li>
        {% endif %}
        {% endfor %}
        
        {% if page_obj.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
        </li>
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last &raquo;</a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

<style>
    .teacher-card {
        transition: all 0.3s ease;
    }
    
    .teacher-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .teacher-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary-color), #818cf8);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 28px;
        font-weight: 600;
    }
    
    .card-footer {
        padding: 15px;
    }
    
    .card-footer h6 {
        font-weight: 600;
        color: #1f2937;
    }
</style>
{% endblock %}
